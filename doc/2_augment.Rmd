# Load and clean data

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      warning = F, message = F,
                      root.dir = '.')
```

```{r libraries}
library("tidyverse")
```


```{r Load data}
clinical_data <- read_csv(file = "../data/_raw/clinical_data_breast_cancer.csv")
PAM50 <- read_csv(file = "../data/_raw/PAM50_proteins.csv")
proteome_data <- read_csv(file = "../data/_raw/77_cancer_proteomes_CPTAC_itraq.csv")
```

## PAM50 data
PAM50 is an acronym for Prediction Analysis of Microarray 50. It is a group of 50 genes related to breast cancer, and is measured from a sample from the patients.

* 100 rows (50 genes with different isotypes)
* 3 columns (ID, symbol and name)

### Cleaning of PAM50 data 
* Remove redundant column
* Rename columns
* Reorder of the columns

```{r Wrangle data}
## Clean PAM50 data
PAM50_clean <- PAM50 %>%
  select(-Species) %>% # Remove redundant column
  select(RefSeqProteinID, everything()) %>% # ID column first
  rename(RefSeq_accession_number = "RefSeqProteinID",
         gene_symbol = "GeneSymbol",
         gene_name = "Gene Name") # Rename columns to similiar column names as in proteome_data
```

## Proteome data
The proteome data contains expression values for 77 patients and 3 controls. 12.553 proteins is measured for each sample, however with some missing values.

* 80 rows (patients + control samples)
* 12.553 columns (proteins)

### Cleaning of proteome data
* Remove replicates
* Remove redundant columns
* Remove non-PAM50 proteins
* Simplify ID names
* Make patient_ID (observations) the rows
* Make proteins (variables) the columns

```{r}
## Clean proteome data
### Identify patient_ID replicates 
replicates <- colnames(proteome_data) %>% 
  str_replace_all(., '\\..*', '') %>% # Simplify ID name
  duplicated() %>% # Find replicates (true/false)
  colnames(proteome_data)[.] # Extract replicate column names (excluding first apperance)

### Clean file
proteome_data_clean <- proteome_data %>%
  select(-gene_symbol, -gene_name) %>% # Remove redundant columns
  select(-replicates)  %>% # Remove replicate columns
  #select(-c(ends_with("CPTAC")))  %>%  # Remove healthy patients (we have no clincal information on them)
  semi_join(., PAM50_clean, by = "RefSeq_accession_number") %>% # Remove non-PAM50 proteins
  rename_all(funs(stringr::str_replace_all(., '\\..*', ''))) %>% # Simplify ID name
  pivot_longer(cols = -c("RefSeq_accession_number"),
               names_to = "patient_ID",
               values_to = "value") %>% # Make proteins (variables) the columns
  pivot_wider(names_from = "RefSeq_accession_number",
              values_from = "value") # Make patient_ID (observations) the rows

```


## Clinical data
The clinical data contains information of the 105 patients originally included in this study.

* 105 rows (patients)
* 30 columns (different clinical measures)

### Cleaning of clinical data
* Simplify ID names
* Remove redundant column
* Remove clinical data for samples that did not pass QC
* Remove whitespaces and dash in column names

```{r}
## Clean clinical data
clinical_data_clean <- clinical_data %>%
  mutate(patient_ID = str_remove_all(.$`Complete TCGA ID`, "TCGA-")) %>% # Simplify ID name
  select(-`Complete TCGA ID`) %>% # Remove old ID column
  semi_join(., proteome_data_clean, by = "patient_ID") %>% # Remove clinical data with no protein information
  select(patient_ID, everything()) # ID column first

names(clinical_data_clean) <- gsub(" ", "_", names(clinical_data_clean)) # Remove whitespaces in column names
names(clinical_data_clean) <- gsub("-", "_", names(clinical_data_clean)) # Remove dash in column names

```

